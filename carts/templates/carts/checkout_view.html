{% extends "base.html" %}
{% load i18n %}
{% load crispy_forms_tags %}

<style >
  {% block style %}

  @media ( min-width: 768px ) {
    .grid-divider {
        position: relative;
        padding: 0;
    }

    .grid-divider>[class*='col-'] {
        position: static;
    }
    .grid-divider>[class*='col-']:nth-child(n+2):before {
        content: "";
        border-left: 1px solid #DDD;
        position: absolute;
        top: 0;
        bottom: 0;
    }
    .col-padding {
        padding: 0 15px;
    }
}

  {% endblock style %}


</style>

<script>
{% block jquery %}
var clientToken = "{{ client_token }}";
braintree.setup(clientToken, "dropin", {
  container: "payment-form"
});

{% endblock %}
</script>


{% block content %}
{% if not user_can_continue %}


<div class="container">

     <div class="row grid-divider">
  <div class="col-sm-6 ">
 <div class="col-padding">
      <div class='card card-container'>
    <p class="lead text-center">Continue as guest</p>
    <form method="post" action="">
      {% csrf_token %}
      {{form|crispy}}
      <input type="submit" class="btn btn-success" value="Continue as Guest"/>
    </form>

  </div>
  </div>
  </div>




  <div class="col-sm-6">
      <div class='card card-container'>
    <p class="lead text-center">Login to continue</p>
    <form method="post" action="{% url 'account_login' %}">
      {% csrf_token %}

      {{login_form|crispy}}

      <input type="hidden" name="next" value="{{ next_url }}" />
      <input class="btn btn-success" type="submit" value="submit" />
    </form>
    <p>{% trans "Forgot password" %}? <a href="{% url 'account_reset_password' %}">{% trans "Reset it" %}</a>!</p>
    <p>{% trans "Not member" %}? <a href="{% url 'account_signup' %}">{% trans "Register" %}</a>!</p>
  </div>
  </div>
  </div>
  </div>

{% else %}

  <h1 class="text-center">My Order</h1>
  <div id="address" class="col-md-8 col-md-offset-2" >
    <table class="table">
      <thead>
        <tr>
          <th>Items:</th>
          <th  class="text-left">Quantity</th>
          <th >Price</th>
        </tr>
      </thead>
      <tbody>
          {% for i in order.cart.cartitem_set.all %}
            <tr>
              <td>{{i.item.get_title}}<!-- <image src="{{i.item.product.get_image_url }}" style="width: 72px; height: 72px;" ></image> --></td>
              <td>{{ i.quantity }}</td>
              <td>{{ i.item.get_price}}</td>
            </tr>
          {% endfor %}
      </tbody>
    </table>
    <div>
      <p class="text-right">
        <strong>Subtotal:</strong>
        ${{ order.cart.subtotal}}
      </p>
    </div>
    <div>
        <p class="text-right">
          <strong>Total:</strong>
          ${{ order.order_total}}
        </p>
    </div>

      <div class="list-group">
        <div class="list-group-item">
          <h4 class="list-group-item-heading">Billing</h4>
          <p class="list-group-item-text">{{order.billing_address.get_addresses}}</p>
        </div>
        <div class="list-group-item">
          <h4 class="list-group-item-heading">shipping</h4>
          <p class="list-group-item-text">{{order.shipping_address.get_addresses}}</p>
        </div>
      </div>


      <a href="{% url 'order_address' %}">Change address</a>
      </form>
        <form id="checkout" method="post" action="{% url 'checkout_final' %}">{% csrf_token %}
        <div id="payment-form"></div>
        <input type="submit" class="btn btn-success" value="complete Order">
      </form>
  </div>
{% endif %}
{% endblock %}
